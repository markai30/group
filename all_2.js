function $node(t,e,a,i,n,r){if(n)var o=!1;else var o=!0;if(i)var i='<span><i class="fa fa-circle-o-notch fa-spin"></i></span>';else var i="";if(!n)var n=!1;if(!r)var r=400;$("#dialog").dialogBox({width:r,autoSize:!0,autoHide:a,time:3e3,zIndex:999999,hasMask:!0,hasClose:o,Maskoff:n,effect:"sign",title:t,content:i+e})}function timeedit(t){if(1==/\:/.test(t)){var e=t.match(/(\d+)\:(\d+)/),a=new Date;if(1==/yesterday/i.test(t))return"Ngày hôm qua lúc "+e[1]+" giờ "+e[2]+" phút";if(1==/today/i.test(t)){var i=e[1],n=e[2],r=a.getHours()-Number(i),o=a.getMinutes()-Number(n);return 0==r?"Khoảng "+o+" phút trước.":r+" tiếng trước."}if(1==/\./g.test(t)){var e=t.split(" "),s=e[1].split(":");return e[0]+" vào lúc "+s[0]+" giờ "+s[1]+" phút"}var l=t.replace(" - "," "),c=new Date(l);return c.getDate()+"."+(c.getMonth()+1)+"."+c.getFullYear()+" vào lúc "+c.getHours()+" giờ "+c.getMinutes()+" phút."}return t}function $deltopic(t){var e=$(this).closest(".topic-line"),a=$(this).closest(".forum-line"),i=a.find(".topic-comment"),n=Number(i.attr("data"))-1;if(i.attr("data",n).find("span").text(n),e.slideUp(500),t)var r=t;else var r=this.href;$.post(r,{confirm:1})}function $codepost(){var t=$(this).closest("form").find(".comment-textarea"),e=t.next(".wysibb-body");0==e.length?(t.trigger("click"),t.execCommand("code")):(t.hide(),e.show(),t.execCommand("code"))}function $smilepost(){var t=["#so.O","#sO.o","#s:'(","#s:(","#s:O","#s:D","#s<3","#s^_^","#s:*","#s:v","#s<()","#s:poop:","#s:putnam:","#s(^^^)","#s:)","#s-_-","#s8|","#s:P","#s:/","#s;)","#s(y)","#s:3","#s:|]","#s8)"],e="";$.each(t,function(t,a){e+='<img onclick="$smilesend.call(this)" class="smile-post" src="http://illiweb.com/fa/empty.gif" alt="'+a+'">'});var a=$(this).next(".result-smile");if(0==a.length)$(this).after('<div class="result-smile">'+e+"</div>");else{var i=a.attr("style");void 0!=i&&(i.indexOf("none")>-1?a.show():a.hide())}}function $smilesend(){$this=$(this);var t=$(this).attr("alt").replace("#s"," "),e=$(this).closest("form").find(".comment-textarea"),a=e.next(".wysibb-body");0==a.length?e.trigger("click"):(e.hide(),a.show()),e.insertAtCursor(t+" "),$(this).closest(".result-smile").hide()}function frameforum(){var t=$(this).closest(".status-tab"),e=$(this).contents().find(".forum-result").clone(),a="";e.find(".forum-line").each(function(){var i=$(this),n=i.find(".name-profile a"),r=n.text(),o=n.attr("href").match(/\d+/),s=(i.find(".avata-topic img"),i.find(".topic-like")),l=s.attr("data-href"),c=l.match(/#(\d+)/),d=l.match(/\/t(\d+)-/),h=i.find(".time-profile"),f=i.find(".topic-body").html(),m=i.find(".topic-comment").attr("data");if(0==t.length){var p=$(".comment-editor:eq(0) form").clone();p.attr("data-href","/t"+d[1]+"-topic");var p=p[0].outerHTML,v='<div onclick="$loadcomment.call(this)" class="topic-comment topic-button" data="'+m+'" data-href="/t'+d[1]+'-topic"><i class="fa fa-comment"></i> Bình Luận <span>'+m+"</span></div>",u='<div class="comment-editor"><div class="avata-comment avata-wall avata-small">'+_userdata.avatar+'</div><div class="comment-editor-body wall-editor">'+p+"</div></div>";$nextpage=e.find(".sprite-arrow_prosilver_right"),$nextpage.length?(endPage=!1,$linknext=$nextpage.parent().attr("href")):endPage=!0}else var v="",u="";var g='<img onload="$avataframe.call(this)" src="http://illiweb.com/fa/empty.gif" title="'+r+'" alt="-- '+o+'" />',b='<div data-run="true" data-name="'+r+'" onclick="$likecomment.call(this)" class="topic-like topic-button" data="0" data-id="'+c[1]+'"><i class="fa fa-heart"></i> Thích <span>0</span><div class="list-like-member"><img onload="$loadlike.call(this)" class="hide" src="http://illiweb.com/fa/empty.gif" title="topic" /></div></div>';a+='<div class="forum-line no-active"><div class="topic-profile post-profile"><div class="avata-topic profile-item avata-small">'+g+'</div><div class="topic-name profile-item"><div class="name-profile name-item">'+r+'</div><div class="time-profile name-item"><i class="fa fa-clock-o"></i> '+timeedit(h.text())+'</div><div class="tool-profile"></div></div></div><div class="topic-body body-topic">'+f+'</div><div class="topic-fotter"><div class="fotter-button">'+b+v+'</div><div class="result-body-wall"></div>'+u+"</div></div>"}),$(this).parent()[0].outerHTML=a,attrframe()}function frametopic(){var t=$(this).contents();t.find(".topic-line").each(function(){var t=$(this);t.find('a[href$="mode=delete"]').attr("onclick","event.preventDefault();$deltopic.call(this)").addClass("btt-tool");var e=t.find('a[href$="mode=editpost"]'),a=e.attr("href");e.attr("onclick","$editpost.call(this)"),e.attr("href","javascript:;"),e.attr("data-href",a).attr("data-change",a).addClass("btt-tool");var i=t.find(".name-msg-wall").text();t.find(".comment-like").attr("data-name",i),t.find(".list-like-member").html('<img onload="$loadlike.call(this)" class="hide" src="http://illiweb.com/fa/empty.gif" title="comment" />');var t=$(this).find(".topic-body");/-{10}/.test(t.text())&&t.closest(".topic-line").remove();var n=$(this).find(".time-profile"),r=n.text();n.html('<i class="fa fa-clock-o" aria-hidden="true"></i> '+timeedit(r))});var e=t.find(".blog_comments").html(),a=t.find(".sprite-arrow_prosilver_right");if(a.length>0){var i=a.parent().attr("href");e+='<a class="loadnext next-wall" href="'+i+'" onclick="event.preventDefault();$loadnext.call(this)">Xem thêm tin nhắn nữa</a>'}$ic=$(this).closest(".icont-frame"),$ic[0].outerHTML=e,attrframe()}function attrframe(){$('a[href$="#framepost"]').each(function(){$(this).attr("onclick","event.preventDefault();clickframe.call(this)")})}function clickframe(){this.outerHTML=$rlframe(this.href)}function $loadnext(){var t=this.href;$(this).closest(".result-body-wall");$lthis=$($framehtml),$lthis.find("iframe").attr("src",t);var e=$lthis[0].outerHTML;this.outerHTML=e}function $rlframe(t){var e="300px",a="90%";if(1==/embed\/song/.test(t)||1==/\.mp3#framepost$/.test(t))var e="180px",a="640px";if(1==/embed\/playlist/.test(t))var e="330px",a="640px";if(1==/embed\/video/.test(t))var e="355px",a="560px";if(1==/mh\/auto|mh\/normal/.test(t))var e="382px",a="668px";if(1==/lh\/auto|lh\/normal/.test(t))var e="587px",a="668px";if(1==/vh\/auto|vh\/normal/.test(t))var e="376px",a="668px";if($(window).width()<700)var a="100%";var i=$(this).find(".showframe");if(0==i.length&&1==/youtube|nhaccuatui|mp3\.zing|dailymotion|video|\.mp3#framepost|\.mp4#framepost/.test(t))return'<iframe width="'+a+'" height="'+e+'" frameborder="0" scrolling="no" src="'+t+'" class="showframe" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';if(0==i.length&&1==/vcplayer/.test(t)){var t=t.match(/vid\=(.+)\.mp4/);if(null!=t){var t="https://hls.vcmedia.vn/"+t[1]+".mp4/720.m3u8";return'<iframe width="'+a+'" height="'+e+'" frameborder="0" scrolling="no" src="/h3-genk#'+t+'" class="showframe" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'}}}function editorchanger(t,e){var a=$(e),i=a.attr("contenteditable"),n=a.closest(".wysibb-text").find(".comment-textarea"),r=n.bbcode(),o=a.closest("form"),s=o.attr("data-mode");if(0==r.length&&"editpost"!=s&&null==r.match(/[a-z]/)&&(n.show(),a.hide()),"true"==i&&13==t.keyCode){if(t.shiftKey){var l=n.htmlcode();if(-1==r.indexOf(" "))return $node("Thông báo","Bạn đang cố tình spam nhảm. Vui lòng bình luận nghiêm túc hơn.",!0),!1;if(r.length>10&&r.length<9e3){var c=o.attr("data-href").match(/\d+/)[0],d=o.find('input[name="name-guest"]').val(),h=o.find('input[name="capcha-guest"]').val();if("guest"==s){if(d.length<3)return $node("Thông báo","Bạn chưa nhập tên hoặc tên của bạn quá ngắn.",!0),!1;var f=sessionStorage.getItem("listname");if(null==f){var f=$post("/search?mode=searchuser&fieldname=friend&search_username=","get"),f=f.find("option").text();sessionStorage.setItem("listname",f)}if(f.indexOf(d)>-1)return $node("Thông báo","Tên của bạn đặt đã trùng với tên của thành viên khác trong diễn đàn. Vui lòng đặt lại một tên khác.",!0),!1;if(h.length<3)return $node("Thông báo","Bạn chưa nhập mã kiểm tra.",!0),!1}if("newtopic"==s){if(r.length<150)return $node("Thông báo","Mỗi một bài viết thảo luận mới cần phải có nội dung phong phú và thiết thực.<br>Do đó theo như mình kiểm tra thì bài viết của bạn không thực sự đầu tư cho lắm.<br> Vì thế mong bạn xem xét để bài thảo luận của mình tốt hơn.",!1),!1;var m=new Date,p=localStorage.getItem("timepost");if(null==p)localStorage.setItem("timepost",m);else{var v=new Date(p);if(v.getDate()==m.getDate()&&1!=_userdata.user_level){var u=24-v.getHours(),g=61-v.getMinutes();return $node("Thông báo","Mỗi ngày bạn chỉ được viết một bài thôi.<br>Bạn còn "+u+" tiếng và "+g+" phút nữa mới được post bài tiếp.",!0),!1}localStorage.setItem("timepost",m)}}a.attr("contenteditable","false"),$postwall(r,l,c,s,a)}else $node("Thông báo","Bình luận của bạn quá ngắn hoặc là quá dài. Xin vui lòng bình luận nghiêm túc hơn.",!0)}n.insertAtCursor("<br>")}}function $post(t,e,a){var i="",n={async:!1,url:t,type:e,success:function(t){i=t}};return"object"==typeof a&&(n.data=a),$.ajax(n),$("<div>"+i+"</div>")}function $postwall(t,e,a,i,n){var r=new Date,o="Today at "+r.getHours()+":"+r.getMinutes(),o=timeedit(o),s=$("#header").attr("class"),l=n.closest(".topic-fotter"),c=n.closest("form");if(void 0!=s)var d=" #status-wall";else var d="";if($param=new Object,$param.mode=i,$param.post="Ok","reply"==i&&($param.t=a),"editpost"==i){$param.p=a;var h=n.closest(".topic-edit").find("form"),f=h.attr("data-lt");if(void 0==f){var m=$post("/post?p="+a+"&mode=editpost","get");$param.lt=m.find('input[name="lt"]').val(),$param.subject=m.find('input[name="subject"]').val(),h.attr("data-subject",$param.subject),h.attr("data-lt",$param.lt)}else $param.lt=f,$param.subject=h.attr("data-subject");var e=$("<div>"+e+"</div>"),p=e.find('a[href^="/tags/');if(p.length>0){var d=p.text().replace(/#/g," #");p.remove();var t=n.prev().htmlcode(e).bbcode()}}if("newtopic"==i){$param.f=a;var d="#new-topic",v=$(".show-count-forum").text();$param.subject="Chủ đề thảo luận "+v+" -- "+_userdata.user_id}if("guest"==i){var u=c.find('input[name="capcha-guest"]').val(),g=c.find('input[name="name-guest"]').val();$param.mode="reply",$param.reg_key=u,$param.username=g,$param.t=a,$param.post_confirm=1}if($param.message=t+d,$checke=n.attr("contenteditable"),"false"==$checke){if($data=$post("/post","post",$param),$status=$data.find('a[href*="/viewtopic?t="]'),setTimeout(function(){n.attr("contenteditable","true").html("")},5e3),0==$status.length&&void 0==$status.attr("href")){var b=$data.find('#preview p[style*="red"]');if(b.length>0)return $node("Lỗi rồi",b.html(),!0),$reguest(c),!1;if("guest"!=i)return $node("Lỗi rồi","Đã xảy ra lỗi, vui lòng thử lại sau.",!0),!1;var w=$data.find('img[src^="/antirobot_pic"]').attr("src");if(void 0!=w)return $node("Thông báo","Bạn đã nhập sai capcha. Vui lòng nhập lại.",!0),c.find(".capcha-guest img").attr("src",w),c.find(".capcha-guest input").val(""),!1}else var x=$status.attr("href").match(/t=(\d+).+\#(\d+)/),y="/t"+x[1]+"-topic",k=x[2];var _=_userdata.username,T=$(".wall-body").length;if("editpost"!=i){var O=n.closest("#page-right");if("reply"==i||"guest"==i){if(0==T&&0==O.length)var C=n.closest(".topic-fotter");if(T>0&&0==O.length)var C=n.closest(".wall-result");if(0==T&&O.length>0)var C=O.find(".result-guest-post"),_=$param.username;var j=$(".topic-line:eq(0)"),L=j.clone(),M=C.find(".topic-line:eq(0)"),D=C.find(".topic-comment"),B=Number(D.attr("data"))+1;D.attr("data",B).find("span").text(B);var H='<a data-run="false" onclick="$likecomment.call(this)" href="javascript:;" data="0" data-id="'+k+'" class="topic-button comment-like"><i class="fa fa-heart"></i> Thích <span>0</span></a>';"guest"==i&&$reguest(c)}else{var j=$(".forum-line:eq(0)"),M=j,L=j.clone();L.find(".result-body-wall").html(""),L.find(".topic-comment").attr("data-href",y),L.find(".topic-comment").attr("data",0).find("span").html("0"),L.find(".topic-like span").text(0),L.find(".list-like-member").html("");var H=""}if(0==O.length)var N='<a data-change="/post?p='+k+'&mode=editpost" href="/post?p='+k+'&mode=editpost" onclick="event.preventDefault();$editpost.call(this)" class="btt-tool"></a>',z='<a href="/post?p='+k+'&mode=delete" onclick="event.preventDefault();$deltopic.call(this)" class="btt-tool"></a>';else var N="",z="";if(L.find(".avata-small").html(_userdata.avatar),L.find(".name-profile").html(_),L.find(".time-profile").html('<i class="fa fa-clock-o" aria-hidden="true"></i> '+o),L.find(".topic-body").html(e),L.find(".tool-profile").html(H+N+z),0==M.length){var A=C.find(".topic-comment").attr("data-href"),S=$($framehtml);S.find("iframe").attr("src",A);var q=S[0].outerHTML;C.find(".result-body-wall").html(q)}else{M.before(L),L.hide().slideDown(500);var I=L.offset().top;$("body").scrollTop(I)}}else if(l.length>0||T>0){var R=n.closest(".topic-line");R.removeClass("edit-post"),$status.length>0&&R.find(".topic-body").html(e)}else{var R=n.closest(".forum-line");R.removeClass("edit-post"),$status.length>0&&R.find(".topic-body").html(e)}attrframe()}}function $reguest(t){var e='<textarea class="comment-textarea" onclick="editor.call(this)" placeholder="Bạn có thể đăng bài ở đây"></textarea>';t.find(".block-comment").html(e),t.find(".capcha-guest").html("");var a=t.find(".wysibb");a.length>0&&(a[0].outerHTML=e,t.find(".bottom-guest").remove())}function showupload(){var t=$(this).closest(".comment-topic-post"),e=t.find(".wysibb-body");0==e.length&&t.find(".comment-textarea").trigger("click");var a=t.find(".tip-form-post");0==a.find(".body-form-upload").length||a.show()}function showrowupload(){$(this).closest(".changer-item").find(".active").removeClass("active"),$(this).addClass("active");var t=$(this).text(),e=$(this).closest(".tip-form-post");e.find(".row-item-body").removeClass("active"),1==/Video/.test(t)?e.find(".video-upload-row").addClass("active"):e.find(".image-upload-row").addClass("active")}function $uploadimg(){var t=$(this),e=t.closest(".tip-form-post"),a=t.closest(".comment-topic-post"),i=e.find(".preview-img-up"),n=e.find(".file-uploader"),r=e.find(".img-preview-upload img"),o=this.files[0];e.find("input").attr("disabled","disabled"),r.attr("src",URL.createObjectURL(o)),n.hide(),i.show(),uploadxhr(o,"picasanew").done(function(o){var s=JSON.parse(o);if(e.removeClass("disabled"),t.removeAttr("disabled"),0==s.error){var l='<img src="'+s.url+'"><br>';a.find(".wysibb-texarea").insertAtCursor(l+"<br/>"),e.hide(),r.attr("src","http://illiweb.com/fa/empty.gif"),e.find("input").removeAttr("disabled"),n.show(),i.hide()}})}function editor(){var t=$(this).attr("id");if(void 0==t){$(this).wysibb();var e=$(this).closest(".comment-topic-post").find(".wysibb-text-editor");e.attr("onkeyup","editorchanger(event,this)");var a=$(this).closest("form").attr("data-mode");$(this).insertAtCursor("");var i={username:"guestcomment",t:31,message:"capcha getpost",mode:"reply",post:"Ok"};if("guest"==a){var n=$post("/post","post",i),r=n.find('img[src^="/antirobot_pic"').attr("src");$(this).closest('form[data-mode="guest"]').find(".capcha-guest").html('<img src="'+r+'"/><input name="capcha-guest" maxlength="5" placeholder="Nhập mã capcha vào đây."/>').hide().slideDown("slow")}if("reply"==a&&0==_userdata.session_logged_in){var o=$(this).closest("form"),s=o.attr("data-href").match(/\/t(\d+)/);i.t=s[1];var n=$post("/post","post",i),r=n.find('img[src^="/antirobot_pic"').attr("src"),l='<div class="bottom-guest"><div class="name-guest-input"><input placeholder="Nhập tên bạn vào đây" name="name-guest"></div><div class="capcha-guest" style="display: block; overflow: hidden;"><img src="'+r+'"><input maxlength="5" name="capcha-guest" placeholder="Nhập mã capcha vào đây."></div></div>';o.find(".wysibb").before(l),o.addClass("guest").attr("data-mode","guest")}}else $(this).hide(),$(this).next().show(),$(this).insertAtCursor("")}function $getcapcha(){var t={username:"guestcomment",t:31,message:"capcha getpost",mode:"reply",post:"Ok"};$post("/post","post",t)}function insertimg(){var t=$(this).closest(".comment-topic-post.active"),e=t.find('input[name="image-link-upload"]');if(e.val().length>0&&1==/.png|.jpg|.gif|.jpeg/.test(e.val())){var a='<img src="'+e.val()+'"><br>';t.find(".comment-textarea").trigger("click"),t.find(".comment-textarea").insertAtCursor(a+"<br/>"),t.find(".tip-form-post").hide(),e.val("")}else $node("Thông báo","Vui lòng nhập đúng link ảnh để nhúng.",!0)}function changervideo(t,e){if(t.length>0&&1==/.mp3|.mp4|nhaccuatui|vimeo|dailymotion|mp3.zing|youtube|youtu.be|vcplayer/.test(t)){var t=t.replace(/^\s+/,"").replace(/\s+$/,"");if(t.indexOf(".mp3")>-1)var a=t,i=!1;if(t.indexOf(".mp4")>-1)var a=t,i=!1;if(t.indexOf("nhaccuatui.com")>-1){var i="nct";if(t.indexOf("/auto|normal|background/")>-1)var a=t,n=a.match(/\/(\w+)$/);else{if(t.indexOf("bai-hat")>-1){var r=t.match(/bai\-hat\/.+\.(.+)\.html/);if(null!=r&&2==r.length)var a="http://www.nhaccuatui.com/mh/auto/"+r[1],n=r[1]}if(t.indexOf("playlist")>-1){var r=t.match(/playlist\/.+\.(.+)\.html/);if(null!=r&&2==r.length)var a="http://www.nhaccuatui.com/lh/auto/"+r[1],n=r[1]}if(t.indexOf("video")>-1){var r=t.match(/video\/.+\.(.+)\.html/);if(null!=r&&2==r.length)var a="http://www.nhaccuatui.com/vh/auto/"+r[1],n=r[1]}}}if(t.indexOf("vimeo.com")>-1){var i="vimeo",n=!1;if(t.indexOf("player")>-1)var a=t;else{var r=t.match(/\d+/);if(null!=r)var a="https://player.vimeo.com/video/"+r+"&autoplay=1"}}if(t.indexOf("dailymotion.com")>-1){var i=!1;if(t.indexOf("/embed/")>-1)var a=t;else{var r=t.match(/video\/(\w+)\_/);if(null!=r)var a="http://www.dailymotion.com/embed/video/"+r[1]}}if(t.indexOf("mp3.zing.vn")>-1){var i="zing",n=t;if(t.indexOf("/embed/")>-1)var a=t,n=!1;else{if(t.indexOf("bai-hat")>-1){var r=t.match(/bai\-hat\/.+\/(\w+)\.html/);if(null!=r&&2==r.length)var a="http://mp3.zing.vn/embed/song/"+r[1]+"?start=true"}if(t.indexOf("album")>-1){var r=t.match(/album\/.+\/(\w+)\.html/);if(null!=r&&2==r.length)var a="http://mp3.zing.vn/embed/playlist/"+r[1]+"?start=true"}if(t.indexOf("video-clip")>-1){var r=t.match(/video\-clip\/.+\/(\w+)\.html/);if(null!=r&&2==r.length)var a="http://mp3.zing.vn/embed/video/"+r[1]+"?start=true",n=t}}}if(t.indexOf("youtube")>-1||t.indexOf("youtu.be")>-1){var i="ytb";if(t.indexOf("/embed/")>-1)var a=t,n=a.match(/\/embed\/([a-z0-9_-]+)/i)[1];else{if(-1!=t.indexOf("youtu.be"))r=t.match(/^http[s]*:\/\/youtu\.be\/([a-z0-9_-]+)/i);else var r=t.match(/^http[s]*:\/\/www\.youtube\.com\/watch\?.*?v=([a-z0-9_-]+)/i);if(null!=r)var a="http://www.youtube.com/embed/"+r[1]+"?autoplay=1",n=r[1]}}if(t.indexOf("vcplayer")>-1)var a=url,i=!1;if(a){var o={src:a,id:n,server:i};return o}return!1}return t.length>0?(e.text("Không hỗ trợ link video này.").removeClass("active").prev("iframe").remove(),!1):(e.text("Không có Video.").removeClass("active").prev("iframe").remove(),!1)}function previewinput(){var t=$(this).val(),e=$(this).closest(".comment-topic-post.active"),a=e.find(".tip-video-preview");a.parent().find("iframe").remove();changervideo(t,a)}function $loadcomment(){var t=$(this).attr("data-href"),e=$(this).attr("data");if(Number(e)>0){var a=$($framehtml);a.find("iframe").attr("src",t);var i=a[0].outerHTML;$(this).closest(".topic-fotter").find(".result-body-wall").html(i),$(this).removeAttr("onclick")}}function insertvideo(){var t=$(this).closest(".comment-topic-post.active"),e=t.find(".tip-video-preview"),a=t.find('input[name="video-link-upload"]');if($this=$(this),a.val().length>0){var i=changervideo(a.val(),e);"object"==typeof i&&0!=i.server&&($this.hide(),$.post("http://php-forumotion.rhcloud.com/group/video.php",{server:i.server,link:i.src,id:i.id}).done(function(n){if(1==n.check&&(t.find(".comment-textarea").trigger("click"),t.find(".wysibb-body").append(n.html+"<br><br>")),0==n.check&&n.time)$node("Xin lỗi","Bạn cần phải đợi thêm "+n.time+" giây nữa mới dùng được chức năng này.",!0);else{var r='<a href="'+i+'#framepost"></a><br><br>',o=t.find(".comment-textarea");o.trigger("click"),o.insertAtCursor(r+"<br>"),t.find(".wysibb-body").find('a[href$="#framepost"]').click(function(t){t.preventDefault(),$node("Xin lỗi","Không thể xem video trên khung viết bài.",!0)})}t.find(".tip-form-post").hide(),e.text("Không có Video.").removeClass("active").prev("iframe").remove(),a.val(""),$this.show()}))}}function settime(){this.outerHTML=timeedit(this.title)}function uploadxhr(t,e){var a=new FormData;return a.append("files[]",t),a.append("type","upload"),a.append("watermark",0),a.append("watermark_position","br"),a.append("watermark_logo",1),a.append("resize",0),a.append("server",e),$.ajax({url:"http://php-forumotion.rhcloud.com/upload/upload.php",type:"POST",data:a,enctype:"multipart/form-data",contentType:!1,processData:!1})}function $avataframe(){var t=$(this),e=t.attr("title"),a=t.closest(".forum-line").find(".topic-comment").attr("data-href"),i=t.attr("alt").match(/--\s(\d+)/);if(e==_userdata.username||1==_userdata.user_level){var n=t.closest(".topic-profile").find(".tool-profile"),r='<a data-href="'+a+'" href="javascript:;" onclick="$editpost.call(this)"><i class="fa fa-pencil"></i> Sửa Bài</a>',o='<a data-href="'+a+'" href="javascript:;" onclick="$delpost.call(this)"><i class="fa fa-trash"></i> Xóa Bài</a>';n.html(r+o)}if(null!=i){var s=sessionStorage.getItem("avata"+i[1]);null!=s?(t.attr("src",s),setTimeout(function(){t.removeAttr("onload")},500)):$.get("/ajax/index.php?f=m&user_id="+i[1]).done(function(e){t.attr("src",e),sessionStorage.setItem("avata"+i[1],e),setTimeout(function(){t.removeAttr("onload")},500)});var l=t.closest(".topic-profile").find(".name-profile"),e=l.text();l.html('<a href="/u'+i[1]+'">'+e+"</a>")}}function $delpost(){var t=$(this).closest(".forum-line");t.slideUp(500);var e=$(this).attr("data-href");$.get(e).done(function(e){var a=$("<div>"+e+"<div>"),i=a.find('.tool-topic a[href$="mode=delete"]').attr("href"),n=a.find('.tool-topic a[href$="mode=editpost"]').attr("href");t.find('a[onclick*="$editpost"]').attr("data-change",n),$deltopic(i)})}function closeedit(){$(this).closest(".edit-post").removeClass("edit-post")}function $editpost(){var t=$(this).parent().attr("class");if($(".edit-post").removeClass("edit-post"),t.indexOf("wall")>-1)var e=$(this).closest(".topic-line"),a=e.find(".tool-profile");else var e=$(this).closest(".forum-line"),a=e.find(".post-profile");var i=$(this).attr("data-href");$check=$(this).attr("data-change"),e.addClass("edit-post"),o=a.find(".topic-edit form");var n=e.find(".topic-body");n.find('a[href="/tags/new-topic"]').remove();var n=n.html();if(0==o.length){var r=$(".comment-topic-post:eq(0)").clone(),r=r[0].outerHTML;a.append('<div class="topic-edit"><span onclick="closeedit.call(this)" class="close-edit fa fa-times-circle"></span>'+r+"</div>")}var o=e.find(".topic-edit form");o.attr("data-mode","editpost"),void 0==$check?$.get(i).done(function(t){var a=$("<div>"+t+"<div>"),i=a.find('.tool-topic a[href$="mode=delete"]').attr("href"),n=a.find('.tool-topic a[href$="mode=editpost"]').attr("href");e.find('a[onclick*="$delpost"]').attr("data-change",i),e.find('a[onclick*="$editpost"]').attr("data-change",n),o.attr("data-href",n)}):o.attr("data-href",$check),$editor=o.find("textarea"),$editor.trigger("click"),$editor.htmlcode(n),o.find(".wysibb-body").focus()}function $dellog(){$("#dialog")[0].outerHTML='<div id="dialog"></div>',$("#dialog-box-mask").fadeOut(500,function(){$(this).remove()})}function $showtab(){var t=$(this).attr("data-show"),e=$(this).closest(".tab-show-main");e.find(".active").removeClass("active"),$(this).addClass("active"),e.find("."+t).addClass("active")}function $loadlike(){$(".item-wall").attr("href","/u"+_userdata.user_id);var t=$(this),e=t.attr("title"),a=t.closest(".topic-button"),i=a.find("span");if("topic"==e)var n=t.closest(".forum-line").find(".body-topic");else var n=t.closest(".topic-line").find(".msg-body-wall");var r=n.find('a[href$="#thanklist"]');if(r.length>0){var o=r.text(),s=o.split(","),l=s.length,c=_userdata.username;new RegExp(c+",|, "+c);this.outerHTML=o,a.attr("data",l),i.text(l)}r.remove(),t.remove();var d=n.html(),h=n.find("code");if(h.length>0){h.closest(".codebox").find("dt").attr("onclick","$selectcode.call(this)");for(var f=h.html().split("<br>"),m="",p=0;p<f.length;p++)f[p].length>1&&(m+="<li>"+f[p]+"</li>");h[0].outerHTML='<ul class="code-list">'+m+"</ul>"}var v=d.split("<br>");if(v.length>4&&d.length>200&&-1==d.indexOf("<code>")){for(var u="",p=0;p<v.length;p++)u+=v[p]+"<br>",3==p&&(u+='<div class="spoiler-text"><a href="javascript:;" onclick="$spoiler.call(this)" class="spoiler-show">Xem Thêm...</a><div class="spoiler-content">');u+="</div></div>",n.html(u)}if(d.length>1e3&&v.length<3){var g=d.length,b=d.slice(0,700),w=d.slice(700,g),x=b+'<div class="spoiler-text plain-text"><a href="javascript:;" onclick="$spoiler.call(this)" class="spoiler-show">Xem Thêm...</a><div class="spoiler-content">'+w+"</div></div>";n.html(x)}}function selectcode(t){var e=document.createRange();e.selectNodeContents(t);var a=window.getSelection();a.removeAllRanges(),a.addRange(e)}function $selectcode(){selectcode($(this).closest(".codebox").find(".code-list")[0])}function $spoiler(){$(this).hide().next().slideDown("400")}function $status(){var t=$(this).closest(".member-status");t.find(".head-tab").append(_userdata.username),t.find(".wrap-btt-avata").before(_userdata.avatar)}function $postavata(t){return $.post("/profile",{page_profil:"avatars",mode:"editprofile",user_id:_userdata.user_id,avatarremoteurl:t,submit:1})}function $avataupload(){var t=this.files[0],e=t.type,a=window.URL||window.webkitURL;if(1==/jpeg|jpg|gif|png/.test(e)){var i=new Image;i.onload=function(){var e=this.width,a=this.height;if(241>e&&241>a&&t.size<63488){var n=$(".wall-body");if(n.length>0)var r=$("#img-header img");else var r=$(".avata-member img");r.attr("src",i.src),r.after('<div class="bar-avata-upload"><i class="fa fa-circle-o-notch fa-spin"></i> Đang cập nhật..</div>');var o=$(".bar-avata-upload");$(".wrap-btt-avata").hide(),uploadxhr(t,"picasanew").done(function(t){var e=JSON.parse(t);$(".wrap-btt-avata").show(),0==e.error?$postavata(e.url).done(function(t){o.addClass("active").text("Cập nhật thành công"),setTimeout(function(){o.remove()},2e3),$(".avata-upload").val(""),$(".avata-comment img").attr("src",e.url),_userdata.avatar='<img src="'+e.url+" />"}):$node("Lỗi rồi","Upload không thành công",!0)})}else $node("Lỗi rồi","Hình của bạn quá lớn, vui lòng chọn hình khác",!0)},i.src=a.createObjectURL(t)}else $node("Lỗi rồi","Avata phải là ảnh png,jpg,gif,jpeg",!0)}function $likecomment(){var t=$(this),e=t.attr("data-name"),a=_userdata.username,i=t.attr("data-run"),n=t.find(".list-like-member"),r=n.text();if(e!=a&&-1==r.indexOf(a)&&_userdata.session_logged_in>0){var o=t.attr("data-id"),s=t.find("span"),l=s.text();if("true"==i)if(s.text(Number(l)+1),t.attr("data-run","false"),void 0==o){var c=t.attr("data-href");$.get(c).done(function(e){var i=$("<div>"+e+"</div>").find(".id-topic-thank");if(i.length>0)$.post("http://php-forumotion.rhcloud.com/group/thank.php",{p:i.text(),name:a}).done(function(e){var i=e;if(0==i.check){if(void 0!=i.time){t.attr("data-run","true");var r="Bạn cần phải đợi thêm "+i.time+" giây nữa mới có thể bấm thích tiếp được."}else var r="Đã xảy ra lỗi khi thích vui lòng thử lại.";$node("Thông báo",r,!0),s.text(Number(l));var o=n.text(),c=o.replace(a,"");n.text(c)}else t.attr("data",Number(l)+1),n.append(a)});else{$node("Thông báo","Đã xảy ra lỗi khi thích vui lòng thử lại.",!0),s.text(Number(l));var r=n.text(),o=r.replace(a,"");n.text(o)}})}else $.post("http://localhost/face/thank.php",{p:o,name:a}).done(function(e){var i=e;if(0==i.check){if(void 0!=i.time){t.attr("data-run","true");var r="Bạn cần phải đợi thêm "+i.time+" giây nữa mới có thể bấm thích tiếp được."}else var r="Đã xảy ra lỗi khi thích vui lòng thử lại.";$node("Thông báo",r,!0),s.text(Number(l));var o=n.text(),c=o.replace(a,"");n.text(c)}else t.attr("data",Number(l)+1),n.append(a)})}0==_userdata.session_logged_in&&$node("Thông Báo","Bạn không phải là thành viên của diễn đà. Do đó không dùng được tính năng này",!0),e==a&&$node("Thông Báo","Bạn không thể tự thích chính mình được. Bớt tự sướng đi nhé",!0),r.indexOf(a)>-1&&$node("Thông Báo","Bạn đã thích người này rồi. Không thể thích nữa được đâu.",!0)}var $framehtml='<div class="icont-frame fa fa-spinner fa-pulse"><iframe src="" width="100%" height="0" onload="frametopic.call(this)" class="hide"></iframe></div>';$(function(){$(".comment-textarea").focusin(function(){$(".placehold").hide()}),$(".comment-textarea").focusout(function(){$(this).text().length>0?$(".placehold").hide():$(".placehold").show()}),$("html").click(function(t){var e=$(t.target).closest(".comment-topic-post"),a=e.length;0==a?($(".tip-form-post").hide().find("iframe").remove().find("input").val(""),$(".comment-topic-post").removeClass("active"),$(".result-smile").hide()):e.addClass("active")}),attrframe()});
