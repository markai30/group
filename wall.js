function checkobj(t){var a=$(".field-id .field_uneditable").text();return JSON.parse(a)}function $lineinfo(t,a){if(1==$useredit){var i='<a href="javascript:;" onclick="showedit.call(this)" class="btt-edit"><i class="fa fa-pencil"></i> Chỉnh Sửa</a>',e='<div class="edit-line line-view">      <input type="text" data="'+a+'" class="info-view-input" value="'+t+'" maxlength="255"/>    </div>';$sedit='<div class="submit-post">        <a href="javascript:;"  onclick="fieldpost.call(this)">Lưu Thay Đổi</a>        <a href="javascript:;" onclick="fielddie.call(this)">Hủy</a>      </div>'}else{var i="",e="";$sedit=""}var l='<div class="line-info-wall">  <div class="line-left">'+a+'</div>  <div class="line-right">    <div class="body-line line-view">      <div class="text-line-view">'+t+"      </div>"+i+"    </div>"+e+"  </div></div>";return l}function $begin(){var t=$("#title-forum").text();if(t==_userdata.username?$useredit=!0:$useredit=!1,$objwall=checkobj(),0!=$objwall){var a="";if($.each($objwall,function(t,i){0==/Background|Music|topic/.test(t)&&(a+=$lineinfo(i,t))}),a+=$sedit,$(".body-info-wall").html(a),$(".wall-editor form,.topic-comment").attr("data-href","/t"+$objwall.topic+"-topic"),$(".wall-editor form").attr("data-mode","reply"),1==$useredit&&(""==$objwall.topic&&$.post("/post",{mode:"newtopic",f:"4",subject:"Trang Wall Của"+_userdata.username,message:"------------------------------------------",post:"Ok"}).done(function(t){var a=t.match(/viewtopic\?t\=(\d+)/);if(void 0!=a[1]){$objwall.topic=a[1],fieldpost(),$("#post-topic").show(),$(".wall-editor form,.topic-comment").attr("data-href","/t"+$objwall.topic+"-topic");var i=$($framehtml);i.find("iframe").attr("src","/t"+$objwall.topic+"-topic"),$(".result-body-wall").html(i)}}),$editavata()),1==/http/.test($objwall.Music)&&$(".video-wall .content-text-wall").append($rlframe($objwall.Music)),$objwall["Trạng Thái:"].length>0&&$("#text-header p").text($objwall["Trạng Thái:"]),1==/.jpg|.jpeg|.png|.gif/.test($objwall.Background)&&($("#header").attr("style","background: #e9ebee url("+$objwall.Background+") no-repeat left top;background-size: contain;"),$(".img-header-hide").attr("src",$objwall.Background)),""!=$objwall.topic){var i=$($framehtml);i.find("iframe").attr("src","/t"+$objwall.topic+"-topic"),$(".result-body-wall").html(i)}else $("#post-topic").hide(),$(".result-body-wall").html('<div class="alert-msg">Thành viên này vẫn chưa bật tường nhà</div>')}}function showedit(){$this=$(this).closest(".line-right"),$this.find(".body-line").hide(),$this.find(".edit-line").show(),$(".submit-post").show()}function fielddie(){$(".body-line").show(),$(".edit-line,.submit-post").hide()}function loadwallmsg(){$(".item-link-wall .active").removeClass("active"),$(this).addClass("active");var t=$(this).attr("data");$(".wall-item-body").hide(),$("."+t).show()}function fieldpost(){var t=$(this);t.removeAttr("onclick"),$(".info-view-input").each(function(){var t=$(this).attr("data"),a=$(this).attr("value");$objwall[t]=a,$(this).closest(".line-right").find(".text-line-view").text(a)});var a=JSON.stringify($objwall).replace(/\"/g,'\\"');return $.post("/ajax_profile.forum?jsoncallback=?",{id:1,user:_userdata.user_id,active:"1",content:'[["profile_field_13_1","'+a+'"]]'},{},"json").done(function(a){void 0!=a[1]&&(t.attr("onclick","fieldpost.call(this)"),fielddie())}).fail(function(){t.attr("onclick","fieldpost.call(this)"),fielddie()})}function $editavata(){var t='<div class="wrap-btt-avata"><a class="btt-show-avata tip-hover" href="javascript:;"><i class="fa fa-camera" aria-hidden="true"></i></a><div class="show-tip-text">Cập nhật ảnh đại diện</div><input class="avata-upload" onchange="$avataupload.call(this)" accept="image/*" type="file" name="files[]" multiple=""></div>',a='<div class="wrap-btt-avata btt-bg"><a class="btt-show-avata tip-hover" href="javascript:;"><i class="fa fa-camera" aria-hidden="true"></i></a><div class="show-tip-text">Cập nhật ảnh nền</div><input class="bg-upload" onchange="$bgupload.call(this)" accept="image/*" type="file" name="files[]" multiple=""></div>';$(".img-header-hide").after(a),$("#img-header").append(t),$(".video-wall .content-text-wall").append('<a href="javascript:;" class="update-video" onclick="$updatevideo.call(this)"><i class="fa fa-pencil"></i> Chỉnh Sửa</a>')}function $updatevideo(){var t=$(this).closest(".content-text-wall");t.find("iframe").remove();var a=t.find(".input-update-video");0==a.length?$(this).after('<div class="input-update-video"><input type="text" onchange="$setvideo.call(this)" placeholder="Nhập link video của bạn vào đây" /><small class="tip-update-video">* Hỗ trợ link youtube, dailymotion, vimeo,nhaccuatui,mp3.zing, .mp3,.mp4</small></div>'):a.show()}function $setvideo(){var t=$(this),a=t.val(),a=changervideo(a,t.next());if(0!=a){if(/youtu|vimeo|dailymotion/.test(a))var a=a+"?rel=0&autoplay=1";if(/nhaccuatui/.test(a))var a=a.replace("normal","auto");if(/mp3.zing/.test(a))var a=a+"?start=true";$(".input-update-video").hide(),$(".video-wall .content-text-wall").append($rlframe(a.src)),$objwall.Music=a.src,t.attr("disable","disable"),fieldpost().done(function(){t.removeAttr("disable")})}""==t.val()&&($objwall.Music="",t.attr("disable","disable"),fieldpost().done(function(){t.removeAttr("disable")}))}function $bgupload(){var t=this.files[0],a=t.type,i=window.URL||window.webkitURL;if(1==/jpeg|jpg|gif|png/.test(a)){var e=new Image;e.onload=function(){var a=this.width,i=this.height;if(466>i&&a>409&&i>249){$(".img-header-hide").attr("src",e.src),$("#header").attr("style","background: #E9EBEE url("+e.src+") left top no-repeat;background-size: contain;"),$(".img-header-hide").after('<div class="bar-avata-upload bg-upload-bar"><i class="fa fa-circle-o-notch fa-spin"></i> Đang cập nhật..</div>');var l=$(".bg-upload-bar");$(".wrap-btt-avata").hide(),uploadxhr(t,"picasanew").done(function(t){var a=JSON.parse(t);$(".wrap-btt-avata").show(),0==a.error?($objwall.Background=a.url,fieldpost().done(function(){l.addClass("active").text("Cập nhật thành công"),setTimeout(function(){l.remove()},2e3),$(".bg-upload").val("")})):$node("Lỗi rồi","Upload không thành công, vui lòng thử lại.",!0)})}else $node("Lỗi rồi","Hình của bạn quá lớn, vui lòng chọn hình khác.<br>Lưu ý rằng hình của bạn hình của bạn có chiều rộng không thấp hơn 408px.<br>Và chiều cao ảnh của bạn không vượt quá 466px,và cũng không được thấp quá 248px",!0)},e.src=i.createObjectURL(t)}else $node("Lỗi rồi","Vui lòng upload đúng định dạng ảnh. Hỗ trợ ảnh jpg,gif,png,jpeg.",!0)}$begin();
